name: Test ADB Connection

on:
  workflow_dispatch: {}

jobs:
  check-adb:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Prepare Wallet
      run: |
        mkdir -p $HOME/adb_wallet
        echo "${{ secrets.ADB_WALLET }}" | base64 --decode > wallet.zip
        unzip -o wallet.zip -d $HOME/adb_wallet

    - name: Test ADB Connection with Python
      run: |
        python3 -m pip install oracledb --upgrade
        python3 - <<EOF
import os
import oracledb

os.environ["TNS_ADMIN"] = "$HOME/adb_wallet"

conn = oracledb.connect(
    user="${{ secrets.ADB_USER }}",
    password="${{ secrets.ADB_PASSWORD }}",
    dsn="${{ secrets.ADB_TNS }}"
)

cur = conn.cursor()
cur.execute("SELECT sysdate FROM dual")
print("Connected successfully! SYSDATE =", cur.fetchone()[0])
EOF

